---
import { Image } from "astro:assets";
import logo from "@assets/svg/logo.svg";
import menuIcon from "@assets/svg/menu.svg";
import closeIcon from "@assets/svg/close.svg";

const NAVIGATION = [
  { label: "inicio", href: "/#inicio" },
  { label: "Curso", href: "/#curso" },
  { label: "Inversión", href: "/#inversion" },
  { label: "Gali Marli", href: "/#gali-marli" },
  { label: "Testimonios", href: "/#testimonios" },
  { label: "FAQs", href: "/#faqs" },
  { label: "Contacto", href: "/#contacto" },
];
---

<header
  id="site-header"
  class="fixed inset-x-0 top-0 z-50 bg-primary/95 text-accent shadow-lg backdrop-blur-sm"
  data-menu-open="false"
>
  <div
    class="mx-auto flex w-full max-w-6xl items-center justify-between gap-6 px-4 py-4 lg:px-6 lg:py-5"
  >
    <a href="/" class="flex items-center gap-3">
      <Image src={logo} alt="Zensory" class="h-8 w-auto md:h-9" />
    </a>

    <button
      type="button"
      class="lg:hidden"
      aria-controls="primary-navigation"
      aria-expanded="false"
      data-menu-toggle
    >
      <Image src={menuIcon} alt="Abrir menú" class="h-6 w-6" />
    </button>

    <nav
      id="primary-navigation"
      class="absolute left-0 right-0 top-full hidden min-h-[calc(100vh-64px)] flex-col items-center gap-10 bg-primary px-6 pb-16 pt-20 text-center text-base font-medium tracking-[0.35em] lg:static lg:min-h-0 lg:flex lg:flex-row lg:items-center lg:gap-10 lg:bg-transparent lg:px-0 lg:py-0 lg:text-[0.72rem] lg:tracking-[0.4em]"
    >
      <button
        type="button"
        class="ml-auto -mt-6 mb-10 lg:hidden"
        aria-controls="primary-navigation"
        aria-expanded="true"
        data-menu-close
      >
        <Image src={closeIcon} alt="Cerrar menú" class="h-6 w-6" />
      </button>
      <ul class="flex w-full flex-col items-center gap-6 lg:w-auto lg:flex-row lg:gap-8">
        {NAVIGATION.map((item) => (
          <li>
            <a
              href={item.href}
              class="relative text-accent transition-colors duration-200 hover:text-white/80 data-[active=true]:font-semibold"
              data-nav-link
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>
  </div>
</header>

<style>
  @reference "../styles/global.css";
</style>

<script>
  document.addEventListener("astro:page-load", () => {
    const header = document.querySelector<HTMLElement>("#site-header");
    const menu = document.querySelector<HTMLElement>("#primary-navigation");
    const toggle = document.querySelector<HTMLButtonElement>("[data-menu-toggle]");
    const closeBtn = document.querySelector<HTMLButtonElement>("[data-menu-close]");
    const navLinks = document.querySelectorAll<HTMLAnchorElement>("[data-nav-link]");

    if (!header || !menu || !toggle || !closeBtn) {
      return;
    }

    const isDesktop = () => window.matchMedia("(min-width: 1024px)").matches;

    const setMenuState = (open: boolean) => {
      header.dataset.menuOpen = open ? "true" : "false";
      menu.classList.toggle("hidden", !open && !isDesktop());
      toggle.setAttribute("aria-expanded", open ? "true" : "false");
      closeBtn.setAttribute("aria-expanded", open ? "true" : "false");
      document.body.classList.toggle("overflow-hidden", open && !isDesktop());
    };

    const closeMenu = () => setMenuState(false);

    toggle.addEventListener("click", () => {
      const open = header.dataset.menuOpen === "true";
      setMenuState(!open);
    });

    closeBtn.addEventListener("click", closeMenu);

    navLinks.forEach((link) => {
      link.addEventListener("click", () => {
        if (!isDesktop()) {
          closeMenu();
        }
      });
    });

    window.addEventListener(
      "resize",
      () => {
        if (isDesktop()) {
          menu.classList.remove("hidden");
          document.body.classList.remove("overflow-hidden");
          header.dataset.menuOpen = "false";
          toggle.setAttribute("aria-expanded", "false");
          closeBtn.setAttribute("aria-expanded", "false");
        } else if (header.dataset.menuOpen !== "true") {
          menu.classList.add("hidden");
        }
      },
      { passive: true }
    );

    const updateActiveLink = () => {
      const currentHash = window.location.hash || "#inicio";
      navLinks.forEach((link) => {
        const isActive = link.getAttribute("href")?.endsWith(currentHash) ?? false;
        link.dataset.active = isActive ? "true" : "false";
      });
    };

    updateActiveLink();

    window.addEventListener("hashchange", updateActiveLink, { passive: true });
  });
</script>
